<html>
    <head>
        <title>Ecollision</title>
        
        <link rel="stylesheet" type="text/css" href="lib/jquery.gridster.min.css">
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" type="text/css" href="fonts/icomoon/style.css">
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        
        <script src="lib/jquery-1.11.1.js"></script>
        <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
        <script src="lib/easeljs-0.7.1.min.js"></script>
        <script src="lib/jquery.gridster.min.js"></script>
        
        <script src="ecollision/debug.js"></script>
        <script src="ecollision/settings.js"></script>
                
        <script src="ecollision/math/vector-math.js"></script>
        <script src="ecollision/math/ball-physics.js"></script>
        
        <script src="ecollision/views/view.js"></script>
        <script src="ecollision/views/debug.js"></script>
        
        <script src="ecollision/ui/widget.js"></script>
        <script src="ecollision/ui/simulation.js"></script>
        <script src="ecollision/ui/graph.js"></script>
                
        <script src="ecollision/ecollision.js"></script>
        
        <script type="text/javascript">
            function downloadJSAtOnload() {
                var element = document.createElement("script");
                element.src = "script.js";
                document.body.appendChild(element);
            }
            if (window.addEventListener)
                window.addEventListener("load", downloadJSAtOnload, false);
            else if (window.attachEvent)
                window.attachEvent("onload", downloadJSAtOnload);
            else window.onload = downloadJSAtOnload;
        </script>
        
    </head> 
    
    <body>
        <div class="gridster">
            <ul></ul>
        </div>

        <script>
            var gridster;
            
            $(function(){
                $.widget("custom.sliderEx", $.ui.slider, {
                    _amount: null,
                    _formatVal: function(val) {
                        if (val > 0.09 && val < 1) {
                            val = val.toPrecision(2);
                        }
                        return val;
                    },
                    _slide: function () {
                        this._superApply(arguments);
  
                        this._amount.text(this._formatVal(this.options.value));
    
                        var pos = this.handle.position();
                        var width = this._amount.width()/2;
                        
                        var newLeft = pos.left;
                        
                        this._amount.css("left", newLeft+"px");
                    },
                    
                    _start: function() {
                        var left = this.handle.css("left");
                        
                        this._amount.css('visibility','visible').hide().fadeIn("fast").css("left", left);
                    },
                    
                    _stop: function() {
                        this._amount.fadeOut("fast");
                    },
                    
                    _create: function() {
                        var min = parseInt(this.element.attr("min"));
                        var max = parseInt(this.element.attr("max"));
                        
                        this.options.min = min;
                        this.options.max = max;
                        
                        if (this.element.attr("step") != undefined) {
                            var step = parseFloat(this.element.attr("step"));
                            
                            this.options.step = step;
                        }
                        
                        var value = this.element.attr("value");
                        if (value == undefined) {
                            this.options.value = min+max/2;
                        } else {
                            this.options.value = parseFloat(value);
                        }
                        
                        this._amount = $('<div class="slider-amount">'+this._formatVal(this.options.value)+'</div>');
                        
                        this.element.append(this._amount).mousedown(function(event) {
                            event.stopPropagation();
                        });
                        
                        this._super();
                    }
                });
                
                function resizeWidgets(e, ui, $widget) {
                
                }
                
                gridster = $(".gridster > ul").gridster({
                    widget_margins: [5, 5],
                    widget_base_dimensions: [100, 100],
                    max_cols: 6,
                    max_rows: 6,
                    resize: {
                        enabled:true,
                        resize: resizeWidgets,
                        stop: resizeWidgets
                    }
                }).data('gridster');

                var widgets = [ ['widget-simulation', 4, 6],
                                ['widget-graph', 2, 2], 
                                ['widget-sim-controls', 2, 2],
                                ['widget-debug-controls', 2, 2],
                                ['widget-ball-controls', 4, 1]
                              ];
            
                $.each(widgets, function(i, widget){
                    var w = widget[0];
                    widget[0] = '<li id="'+w+'"></li>';
                    gridster.add_widget.apply(gridster, widget);
            
                    $("#"+w).load("widgets/"+w+".html");
                });
            });
        </script>
    </body>
</html>