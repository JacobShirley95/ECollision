function SimulationEngine(a,d,f){function h(){this.time=0;this.object2=this.object=null}function e(b,c){var n=new PVector(b.xVel,b.yVel),a=Math.PI/2;0!==b.xVel&&(a=Math.atan(b.yVel/b.xVel));var g=b.xVel*Math.cos(-a)-b.yVel*Math.sin(-a)*b.cOR,f=b.x-c.x,l=b.y-c.y,e=0,e=0!==f?Math.atan(l/f):Math.atan(l/(f-1E-5));n.x=g*Math.cos(e-a);n.y=g*Math.sin(e-a);return n}this.width=a;this.height=d;particles=[];this.edgeCollision=function(b,c){var a=b.cOR;b.x+b.radius>=this.width?c?(b.xVel*=-a,b.yVel*=a):b.x=this.width-
b.radius:0>=b.x-b.radius&&(c?(b.xVel*=-a,b.yVel*=a):b.x=b.radius);b.y+b.radius>=this.height?c?(b.xVel*=a,b.yVel*=-a):b.y=this.height-b.radius:0>=b.y-b.radius&&(c?(b.xVel*=a,b.yVel*=-a):b.y=b.radius)};this.reset=function(){particles=[]};this.addParticle=function(b){if(particles.length<f.maxParticles)b.index=particles.length,particles.push(b);else throw"ERROR: Number of balls exceeds the maximum value set.";};this.removeParticle=function(b){particles.splice(b,1)};this.getParticle=function(b){return particles[b]};
this.numOfParticles=function(){return particles.length};this.collide=function(b,c,a){var f=c.x-b.x,g=c.y-b.y,e=c.radius+b.radius;return f*f+g*g<e*e?(f=new PVector(b.x-c.x,b.y-c.y),c=new PVector(b.xVel-c.xVel,b.yVel-c.yVel),b=c.dotProduct(c),c=-2*c.dotProduct(f),e=f.dotProduct(f)-e*e,e=c*c-4*b*e,g=f=0,0<=e&&(f=(-c-Math.sqrt(e))/(2*b),g=(-c+Math.sqrt(e))/(2*b)),a.time=0<f&&1>=f?f:0<g&&1>=g?g:1,!0):!1};this.handleCollision=function(b){var c=b.object,a=b.object2,f=e(c,a),g=e(a,c),d=(f.x*(c.mass-a.mass)+
2*a.mass*g.x)/(c.mass+a.mass),l=(g.x*(a.mass-c.mass)+2*c.mass*f.x)/(c.mass+a.mass),h=Math.atan((c.y-a.y)/(c.x-a.x)),r=Math.cos(h),u=Math.sin(h),h=d*r+f.y*u,f=d*u-f.y*r,d=l*r+g.y*u,g=l*u-g.y*r;this.seperateObjects(b,c,a);c.xVel=h;c.yVel=f;a.xVel=d;a.yVel=g};this.seperateObjects=function(b,c,a){b=b.time+.001*b.time;if(1>b)c.x-=c.xVel*f.speedConst*b,c.y-=c.yVel*f.speedConst*b,a.x-=a.xVel*f.speedConst*b,a.y-=a.yVel*f.speedConst*b;else{b=a.x-c.x;var e=a.y-c.y;b=a.radius-Math.abs(Math.sqrt(b*b+e*e)-c.radius)+
.1;var e=(new PVector(c.xVel,c.yVel)).getMagnitudeNS()+1E-4,g=(new PVector(a.xVel,a.yVel)).getMagnitudeNS()+1E-4,e=e/(e+g);ang=Math.atan2(c.y-a.y,c.x-a.x);c.x+=b*Math.cos(ang)*e;c.y+=b*Math.sin(ang)*e;e=1-e;a.x-=b*Math.cos(ang)*e;a.y-=b*Math.sin(ang)*e}};this.setBounds=function(b,a){this.width=b;this.height=a};this.update=function(){for(var a=particles,c=0;c<a.length;c++){var f=a[c];this.edgeCollision(f,!0);f.update()}for(var e=[],c=0;c<a.length;c++)for(var f=a[c],g=c+1;g<a.length;g++){var d=a[g],
l=new h;this.collide(f,d,l)&&(l.object=f,l.object2=d,e.push(l))}e.sort(function(a,b){return a.time<b.time});for(c=0;c<e.length;c++)l=e[c],this.handleCollision(l);for(c=0;c<a.length;c++)f=a[c],this.edgeCollision(f,!1)}};function Point2D(a,d){this.x=a;this.y=d};function PVector(a,d){this.x=a;this.y=d;this.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.getMagnitudeNS=function(){return this.x*this.x+this.y*this.y};this.dotProduct=function(a){return this.x*a.x+this.y*a.y};this.normalise=function(){var a=this.getMagnitude();0<a&&(this.x/=a,this.y/=a)};this.reflect=function(a){var d=new PVector(0,0),e=this.dotProduct(a);d.x=this.x-2*e*a.x;d.y=this.y-2*e*a.y;return d};this.getNormal=function(){return new PVector(-this.y,this.x)};this.copy=
function(){return new PVector(this.x,this.y)};this.invert=function(){this.x*=-1;this.y*=-1};this.multiply=function(a){this.x*=a.x;this.y*=a.y};this.scale=function(a){this.x*=a;this.y*=a};this.add=function(a){this.x+=a.x;this.y+=a.y};this.rotate=function(a){var d=this.x,e=this.y;this.x=d*Math.cos(a)-e*Math.sin(a);this.y=d*Math.sin(a)+e*Math.cos(a)}};function Particle(a,d,f,h,e){PhysObject.call(this,a,d,10);this.index=-1;this.radius=f;this.style=h;var b=[],c=0;this.cOR=1;this.selected=!1;this.draw=function(a,f){this.displayObj.x=a;this.displayObj.y=f;var d=this.displayObj.graphics;d.clear();if(this.selected){for(var h=b.length,l=1;l<h;l++){var t=b[(l+c)%h],r=t.x-a,t=t.y-f;d.beginStroke("rgba(100, 100, 100, "+l/h+")").drawCircle(r,t,this.radius).endStroke()}d.beginStroke("red").setStrokeStyle(3).drawCircle(0,0,this.radius).endStroke()}d.beginFill(this.style).drawCircle(0,
0,this.radius).endFill();(this.selected||e.showVelocities)&&d.beginStroke("red").setStrokeStyle(3).moveTo(0,0).lineTo(this.xVel*e.updateRate,this.yVel*e.updateRate).endStroke()};this.select=function(){this.selected=!0};this.deselect=function(){this.selected=!1;b=[]};this.update=function(){this.x+=this.xVel*e.speedConst;this.y+=this.yVel*e.speedConst;var a=b.length;this.selected&&(c++,c%=e.maxTraceLength,a<e.maxTraceLength?b.push(new Point2D(this.x,this.y)):b[c]=new Point2D(this.x,this.y))};this.copy=
function(){var a=new Particle(this.x,this.y,this.radius,this.style,e);a.index=this.index;a.cOR=this.cOR;a.mass=this.mass;a.xVel=this.xVel;a.yVel=this.yVel;return a}}Particle.prototype=new PhysObject;function PhysObject(a,d,f){this.x=a;this.y=d;this.lastX=this.x;this.lastY=this.y;this.yVel=this.xVel=0;this.mass=f;this.displayObj=new createjs.Shape;this.displayObj.x=this.x;this.displayObj.y=this.y;this.capture=function(){this.lastX=this.x;this.lastY=this.y};this.update=function(){this.x+=this.xVel*speedConst;this.y+=this.yVel*speedConst};this.addEventHandler=function(a,e){this.displayObj.addEventListener(a,e)};this.getEnergy=function(){return.5*this.mass*(this.xVel*this.xVel+this.yVel*this.yVel)};
this.draw=function(a,e){this.displayObj.x=a;this.displayObj.y=e}};function Graph(a,d,f,h,e){Widget.call(this,a);this.scaleX=f;this.scaleY=h;this.y=this.x=0;this.engine=d;var b=new createjs.Shape,c=0,n=0,p=0,g=[],m=0,l=150,t=!1,r=0,u=0;this.init=function(){var a=new createjs.Shape,c=new createjs.Shape;a.graphics.beginStroke("red").moveTo(this.x,this.height).lineTo(this.width,this.height);c.graphics.beginStroke("red").moveTo(this.x,this.y).lineTo(this.x,this.height);this.stage.addChild(a);this.stage.addChild(c);this.stage.addChild(b);this.updateData()};this.draw=
function(a){if(null!=this.engine){a=b.graphics;a.clear();for(var d=g.length-1,f=0,l=0;l<d-1;l++){if(t){t=!1;return}var f=f+g[l].y,k=(m+l)%d,h=(m+l+1)%d,q=g[k].x*this.scaleX-c;q>this.width&&(c+=q-this.width);var q=g[k].x*this.scaleX-c,k=g[k].y*this.scaleY+n+p,A=g[h].x*this.scaleX-c,h=g[h].y*this.scaleY+n+p;a.beginStroke("red").moveTo(this.x+q,this.y+this.height-k).lineTo(this.x+A,this.y+this.height-h)}this.paused||(r+=1E3/e.updateRate,u=this.getEnergy(),this.addData(r,u));n=this.height/2-f/g.length*
this.scaleY;this.stage.update()}};this.restart=function(){g=[];c=n=r=u=m=0;t=!0};this.calibrate=function(){p=0};this.zoomIn=function(){this.scaleX*=e.graphZoomFactor;this.scaleY*=e.graphZoomFactor;c*=this.scaleX;n*=this.scaleY;this.updateData()};this.zoomOut=function(){this.scaleX/=e.graphZoomFactor;this.scaleY/=e.graphZoomFactor;c*=this.scaleX;n*=this.scaleY;this.updateData()};this.moveUp=function(){p-=5};this.moveDown=function(){p+=5};this.addData=function(a,b){if(g.length>l){var c=m;m=(m+1)%l;
g[c]=new Point2D(a,b)}else g.push(new Point2D(a,b))};this.updateData=function(){var a=[];l=Math.round(this.width/(1E3/e.updateRate*this.scaleX))+5;var b=g.length-1,c=0;for(b>l&&(c=b-l);c<b;c++)a.push(g[(m+c)%b]);t=!0;m=0;g=a};this.getEnergy=function(){for(var a=0,b=0;b<this.engine.numOfParticles();b++)a+=this.engine.getParticle(b).getEnergy();return Math.round(a/1E3)}}Graph.prototype=new Widget;function Overlay(a,d,f){function h(a,b){return b?h(b,a%b):a}function e(){if(1==c){var a=d.addParticle(y,z,k.mass,k.radius,k.style);a.xVel=k.xVel;a.yVel=k.yVel;q.removeChild(k.displayObj);k=null;b=2}else q.stage.removeChild(g),b=0}Widget.call(this,a);this.hide();var b=0,c=-1,n=crossX=this.width/2,p=crossY=this.height/2,g=new createjs.Shape,m=new createjs.Text("","bold 15px Arial"),l=new createjs.Text("","bold 15px Arial","red"),t=0,r=!1,u=new createjs.Text("","bold 15px Arial");u.x=this.width/2-40;
u.y=10;var x=!1,v=!1,y=0,z=0,k=null,w=h(this.width,this.height),q=this;this.canvas.mousewheel(function(a){0>a.deltaY?k.radius>f.minRadius&&--k.radius:k.radius<f.maxRadius&&(k.radius+=1)});this.resize=function(a,b){w=h(this.width,this.height)};$(document).keydown(function(a){x=a.ctrlKey;v=a.shiftKey});$(document).keyup(function(a){v=x=!1});this.canvas.bind("contextmenu",function(a){return!1});this.init=function(){this.stage.removeAllChildren();n=crossX=this.width/2;p=crossY=this.height/2;this.stage.addChild(u)};
this.stage.addEventListener("stagemousemove",function(a){n=crossX=a.stageX;p=crossY=a.stageY;if(!x){a=Math.round(n/w);var c=Math.round(p/w);crossX=a*w;crossY=c*w}switch(b){case 0:g.x=crossX;g.y=crossY;null!=k&&(k.x=crossX,k.y=crossY);m.x=crossX-50;m.y=crossY-50;break;case 1:var e=g.graphics;a=crossX-g.x;c=crossY-g.y;m.x=g.x+a/2;m.y=g.y+c/2;m.text=Math.round(Math.sqrt(a*a+c*c))+" px/s";k.xVel=a/f.updateRate;k.yVel=c/f.updateRate;e.clear().beginStroke("red").setStrokeStyle(3).moveTo(0,0).lineTo(a,c);
break;case 2:for(e=0;e<d.engine.numOfParticles();e++){var l=d.engine.getParticle(e);a=l.x-n;c=l.y-p;a*a+c*c<=l.radius*l.radius?(l.select(),k=l):l.deselect()}}});this.canvas.mousedown(function(a){if(2==a.button&&2!=b)switch(b){case 0:q.end();e();break;case 1:e()}else switch(b){case 0:g.graphics.clear();q.stage.addChild(g);q.stage.addChild(m);b=1;break;case 1:try{var h=d.addParticle(k.x,k.y,k.mass,k.radius,k.style);h.xVel=k.xVel;h.yVel=k.yVel;h.cOR=k.cOR;q.stage.removeChild(g);q.stage.removeChild(m);
k.xVel=k.yVel=0;1!=c||v?b=0:(b=2,q.stage.removeChild(k.displayObj))}catch(n){l.text=n,l.x=q.width-l.getMeasuredWidth()-10,l.y=q.height/2,q.stage.addChild(l),t=f.errorTime,r=!0}break;case 2:k.displayObj.dispatchEvent("click"),2==a.button?d.removeSelected():(h=k,k=h.copy(),y=h.x,z=h.y,q.stage.addChild(k.displayObj),v||d.removeSelected(),b=0)}a.stopPropagation()});this.draw=function(a){this.hidden||(null!=k&&k.draw(k.x,k.y),r&&(t-=1E3/f.updateRate,0>=t&&(r=!1,this.stage.removeChild(l))),this.stage.update())};
this.beginAdd=function(a,e,l){this.show();this.init();k=new Particle(crossX,crossY,25,l,f);k.mass=a;k.cOR=e;m.x=n;m.y=p;this.stage.addChild(k.displayObj);u.text="Mode: Add";c=b=0};this.beginEdit=function(){this.show();this.init();u.text="Mode: Edit";b=2;c=1};this.end=function(){this.hide();this.stage.removeAllChildren();null!=k&&(k=null);c=-1;v=x=!1};this.getCurrentParticle=function(){return k};this.getMode=function(){return c}}Overlay.prototype=new Widget;function Simulation(a,d,f){Widget.call(this,a);this.engine=d;this.engine.width=this.width;this.engine.height=this.height;var h=-1;this.resize=function(a,b){this.engine.setBounds(a,b)};this.addParticle=function(a,b,c,d,p){a=new Particle(a,b,d,p,f);a.mass=c;var g=this.engine;a.addEventHandler("click",function(a){var b=g.getParticle(h);-1!=h&&b.deselect();for(b=0;b<g.numOfParticles();b++)if(g.getParticle(b).displayObj==a.target){b!=h?(h=b,g.getParticle(b).selected=!0):h=-1;break}});this.stage.addChild(a.displayObj);
this.engine.addParticle(a);return a};this.removeParticle=function(a){this.stage.removeChild(this.engine.getParticle(a).displayObj);this.engine.removeParticle(a)};this.loadParticles=function(a){this.restart();for(var b=0;b<a.length;b++){var c=a[b],d=this.addParticle(c.x,c.y,c.mass,c.radius,c.style);d.xVel=c.xVel;d.yVel=c.yVel;d.cOR=c.cOR}};this.saveParticles=function(a){for(var b=0;b<this.engine.numOfParticles();b++){var c=this.engine.getParticle(b);a.push(c.copy())}};this.removeSelected=function(){-1!=
h&&(this.removeParticle(h),h=-1)};this.getSelected=function(){var a=null;-1!=h&&(a=this.engine.getParticle(h));return a};this.getSelectedID=function(){return h};this.init=function(){};this.restart=function(){this.stage.removeAllChildren();h=-1;this.engine.reset()};this.draw=function(a){for(var b=0;b<this.engine.numOfParticles();b++){var c=this.engine.getParticle(b),d=c.x,h=c.y;f.enableInterpolation&&(h=c.y-c.lastY,d=c.lastX+a*(c.x-c.lastX),h=c.lastY+a*h);c.draw(d,h)}this.stage.update()}}
Simulation.prototype=new Widget;function Widget(a){this.hidden=!1;this.owner=null;this.canvasName=a;this.canvas=$("#"+a);this.width=this.canvas.width();this.height=this.canvas.height();this.canvas.attr("width",this.width);this.canvas.attr("height",this.height);this.stage=new createjs.Stage(a);this.init=function(){};this.addEventListener=function(a,f){this.stage.addEventListener(a,f)};this.draw=function(a){};this.restart=function(){};this.stop=function(){};this.resume=function(){this.paused=!1};this.pause=function(){this.paused=
!0};this.resize=function(a,f){};this.show=function(){this.hidden=!1;this.canvas.fadeIn(200)};this.hide=function(){this.hidden=!0;this.canvas.fadeOut(200)}};function ECollision(a){this.settings=a;this.paused=!1;this.engine=new SimulationEngine(a.simulationWidth,a.simulationHeight,this.settings);this.simulationUI=new Simulation(a.simulationCanvas,this.engine,this.settings);this.graphUI=new Graph(a.graphCanvas,this.engine,.02,5,this.settings);this.overlayUI=new Overlay(a.overlayCanvas,this.simulationUI,this.settings);this.fps=0;var d=[this.simulationUI,this.graphUI,this.overlayUI],f=0,h=0,e=timeStamp=curTime=0,b=a.updateRate,c=1E3/b,n=1E3/a.refreshRate,
p=0,g=-1,m=this;this.start=function(){for(var b=0;b<d.length;b++)d[b].init();g=setInterval(this.tick,1E3/a.refreshRate)};this.restart=function(){for(var a=0;a<d.length;a++)d[a].restart()};this.resume=function(){this.paused=!1;for(var a=0;a<d.length;a++)d[a].resume()};this.pause=function(){this.paused=!0;for(var a=0;a<d.length;a++)d[a].pause()};this.stop=function(){-1!=g&&(clearInterval(g),g=-1)};this.getUpdateRate=function(){return b};this.getUpdateTime=function(){return c};this.setUpdateRate=function(a){b=
a;c=1E3/b};this.setSpeedConst=function(a){this.engine.speedConst=a};this.onTick=function(){};this.update=function(){curTime+=n;if(e+c<curTime){timeStamp=curTime;if(a.enableInterpolation)for(var b=0;b<this.engine.numOfParticles();b++)this.engine.getParticle(b).capture();for(;e+c<curTime;)this.engine.update(),e+=c}p=Math.min(1,(curTime-timeStamp)/c)};this.tick=function(){m.paused||m.update();var a=(new Date).getTime();f++;1E3<=a-h&&(m.fps=f,f=0,h=a);for(a=0;a<d.length;a++)d[a].draw(p);m.onTick()}};var eCollisionSettings={simulationWidth:1E3,simulationHeight:1E3,simulationCanvas:"simulation-canvas",graphCanvas:"graph-canvas",overlayCanvas:"overlay-canvas",refreshRate:60,updateRate:50,showVelocities:!1,enableInterpolation:!0,maxTraceLength:30,graphScaleX:.02,graphScaleY:5,graphZoomFactor:1.25,speedConst:1,maxParticles:100,minRadius:5,maxRadius:30,errorTime:5E3,gridInterval:50};$.widget("custom.sliderEx",$.ui.slider,{_unit:"",_amount:null,_formatVal:function(a){.09<a&&1>a&&(a=a.toPrecision(2));return a+" "+this._unit},_slide:function(){this._superApply(arguments);this._amount.text(this._formatVal(this.options.value));var a=this.handle.position();this._amount.width();this._amount.css("left",a.left+"px")},_start:function(){this._superApply(arguments);var a=this.handle.css("left");this._amount.css("visibility","visible").hide().fadeIn("fast").css("left",a)},_stop:function(){this._superApply(arguments);
this._amount.fadeOut("fast")},_create:function(){var a=parseFloat(this.element.attr("min")),d=parseFloat(this.element.attr("max"));this.options.min=a;this.options.max=d;this.options.step=parseFloat(this.element.attr("step"))||1;this.options.value=parseFloat(this.element.attr("value"))||a+d/2;this._unit=this.element.attr("unit")||"";this._amount=$('<div class="slider-amount">'+this._formatVal(this.options.value)+"</div>");this.element.append(this._amount).mousedown(function(a){a.stopPropagation()});
this._super()}});function getRandomColor(){for(var a="0123456789ABCDEF".split(""),d="#",f=0;6>f;f++)d+=a[Math.floor(16*Math.random())];return d}function toDegrees(a){a=a/Math.PI*180+90;0>a?a+=360:360<a&&(a-=360);return a}function setCol(a,d){return(""+a).fontcolor(d)}function setColGreen(a){return setCol(a,"green")}function dbgBool(a){return a?setCol(""+a,"green"):setCol(""+a,"red")}function log(a){console.log(a)}
$("#slider-mass").sliderEx({slide:function(a,d){var f=ecollision.overlayUI.getCurrentParticle()||ecollision.simulationUI.getSelected();null!=f&&(f.mass=d.value)}});$("#slider-cor").sliderEx({slide:function(a,d){var f=ecollision.overlayUI.getCurrentParticle()||ecollision.simulationUI.getSelected();null!=f&&(f.cOR=d.value)}});
function openAdd(){if(0==ecollision.overlayUI.getMode())ecollision.overlayUI.end();else{var a=$("#slider-mass").sliderEx("value"),d=$("#slider-cor").sliderEx("value");ecollision.overlayUI.beginAdd(a,d,currentColor)}}function openEdit(){1==ecollision.overlayUI.getMode()?ecollision.overlayUI.end():ecollision.overlayUI.beginEdit()}$(document).keypress(function(a){97==a.charCode?openAdd():101==a.charCode&&openEdit()});$("#add-particle").click(function(){openAdd()});$("#remove-particle").click(function(){openEdit()});
var currentColor=getRandomColor();$("#generate-colour").click(function(){var a=ecollision.overlayUI.getCurrentParticle()||ecollision.simulationUI.getSelected();null!=a&&(currentColor=getRandomColor(),a.style=currentColor)});$("#calibrate").click(function(){ecollision.graphUI.calibrate()});$("#zoom-in").click(function(){ecollision.graphUI.zoomIn()});$("#zoom-out").click(function(){ecollision.graphUI.zoomOut()});$("#move-up").click(function(){ecollision.graphUI.moveUp()});$("#move-down").click(function(){ecollision.graphUI.moveDown()});
$("#btn-sim-data").click(function(){eCollisionSettings.showVelocities=!eCollisionSettings.showVelocities});$("#btn-run-pause").click(function(){ecollision.paused?ecollision.resume():ecollision.pause();changeRunPauseBtn()});function changeRunPauseBtn(){ecollision.paused?$("#btn-run-pause").removeClass("icon-pause").addClass("icon-playback-play").text("RUN"):$("#btn-run-pause").removeClass("icon-playback-play").addClass("icon-pause").text("PAUSE")}$("#btn-next").click(function(){ecollision.update()});
var savedState=[];$("#btn-save").click(function(){savedState=[];ecollision.simulationUI.saveParticles(savedState)});$("#btn-load").click(function(){ecollision.simulationUI.loadParticles(savedState)});$("#btn-reset").click(function(){ecollision.restart()});$("#sim-speed-slider").sliderEx({slide:function(a,d){eCollisionSettings.speedConst=parseFloat(d.value)}});var ecollision=new ECollision(eCollisionSettings),fpsDiv=$("#fps-div"),particleInfo=$("#particle-info-box");
ecollision.onTick=function(){(new Date).getTime();if(eCollisionSettings.showVelocities){var a="",a=24>ecollision.fps?setCol(ecollision.fps,"red"):setCol(ecollision.fps,"green");debugStr="Frame rate: "+a+"<br /> Update rate: "+setColGreen(ecollision.getUpdateRate())+" Hz<br /> Energy in system: "+setColGreen(ecollision.graphUI.getEnergy())+" kJ<br /> Number of particles: "+setColGreen(ecollision.engine.numOfParticles());fpsDiv.html(debugStr)}else fpsDiv.html("");a=ecollision.simulationUI.getSelected();
if(null!=a){var d="<b>XVel:</b> "+Math.round(a.xVel*eCollisionSettings.updateRate)+" px/s<br /> <b>YVel:</b> "+Math.round(a.yVel*eCollisionSettings.updateRate)+" px/s<br /> <b>Direction:</b> "+Math.round(toDegrees(Math.atan2(a.yVel,a.xVel)))+" degrees<br /> <b>Mass:</b> "+a.mass+" kg<br /> <b>CoR:</b> "+a.cOR+"<br /> <b>Radius:</b> "+a.radius+" px";"<br /> <b>Energy:</b> "+Math.round(a.getEnergy())+" J";particleInfo.html(d)}else particleInfo.html("")};ecollision.start();